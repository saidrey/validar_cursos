<div class="page-container">
  <!-- Header -->
  <div class="page-header">
    <div class="page-title">
      <span class="material-symbols-outlined title-icon">mail</span>
      <div>
        <h1>Mensajes de contacto</h1>
        <p>Mensajes recibidos desde el formulario de contacto</p>
      </div>
    </div>
    <div class="header-actions">
      <span class="total-badge">{{ correosFiltrados.length }} mensaje{{ correosFiltrados.length !== 1 ? 's' : '' }}</span>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    @if (cargando && correos.length === 0) {
      <div class="loading-state">
        <mat-spinner diameter="40"></mat-spinner>
        <span>Cargando mensajes...</span>
      </div>
    } @else {

      <!-- Buscador -->
      <div class="search-wrapper">
        <span class="material-symbols-outlined search-icon">search</span>
        <input type="text" [(ngModel)]="busqueda"
               placeholder="Buscar por nombre, email o asunto..."
               class="search-input">
        @if (busqueda) {
          <button class="search-clear" (click)="busqueda = ''" title="Limpiar">
            <span class="material-symbols-outlined">close</span>
          </button>
        }
      </div>

      <!-- Tabla -->
      <div class="table-wrap">
        <table class="correos-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Asunto</th>
              <th>Fecha</th>
              <th>Estado</th>
              <th class="actions-th">Acciones</th>
            </tr>
          </thead>
          <tbody>
            @if (correosFiltrados.length === 0) {
              <tr>
                <td colspan="7" class="no-data">
                  <span class="material-symbols-outlined">search_off</span>
                  <span>No se encontraron mensajes</span>
                </td>
              </tr>
            } @else {
              @for (correo of correosFiltrados; track correo.id) {
                <tr>
                  <td class="id-cell">{{ correo.id }}</td>
                  <td>{{ correo.destinatario_nombre }}</td>
                  <td class="email-cell">{{ correo.destinatario_email }}</td>
                  <td class="asunto-cell">{{ correo.asunto }}</td>
                  <td class="fecha-cell">{{ correo.fecha_envio | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td>
                    <span class="badge"
                          [class.badge-ok]="correo.estado === 'enviado'"
                          [class.badge-fail]="correo.estado === 'fallido'">
                      {{ correo.estado === 'enviado' ? 'Enviado' : 'Fallido' }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <button class="action-btn view-btn"
                            (click)="verDetalle(correo)"
                            matTooltip="Ver detalle">
                      <span class="material-symbols-outlined">visibility</span>
                    </button>
                    <button class="action-btn delete-btn"
                            (click)="confirmarEliminar(correo)"
                            matTooltip="Eliminar">
                      <span class="material-symbols-outlined">delete</span>
                    </button>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>

    }
  </div>
</div>
